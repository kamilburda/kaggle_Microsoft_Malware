import array
import numpy
import os


def get_feature(data_set = 'train', data_type = 'bytes'):
    files=os.listdir(data_set)
    with open(f'{data_set}_{data_type}_image.csv','wb') as f:
        f.write('Id,{}\n'.format(','.join([f'{data_type}_{x}' for x in range(1000)])).encode())
        for cc,x in enumerate(files):
            if data_type != x.split('.')[-1]:
                continue
            file_id = x.split('.')[0]
            tmp = read_image(data_set + '/' +x)
            f.write('{},{}\n'.format(file_id, ','.join(v for v in tmp)).encode())
            #print "finish..." + file_id
def read_image(filename):
    f = open(filename,'rb')
    ln = os.path.getsize(filename) # length of file in bytes
    width = 256
    rem = ln%width
    a = array.array("B") # uint8 array
    a.fromfile(f,ln-rem)
    f.close()
    g = numpy.reshape(a,(len(a)/width,width))
    g = numpy.uint8(g)
    g.resize((1000,))
    return list(g)

if __name__ == '__main__':
    #get_feature(data_set = 'train', data_type = 'bytes')
    get_feature(data_set = 'train', data_type = 'asm')
    #get_feature(data_set = 'test', data_type = 'bytes')
    get_feature(data_set = 'test', data_type = 'asm')
    print('DONE asm image features!')

